<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sabarimala 2026 - Admin Dashboard</title>
    <link rel="stylesheet" href="css/styles.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pako/2.1.0/pako.min.js"></script>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ™ Sabarimala 2026</h1>
            <p>Admin Dashboard</p>
            <p id="groupName" class="group-name"></p>
        </div>

        <!-- Loading Overlay -->
        <div id="loadingOverlay" class="loading-overlay" aria-live="polite" aria-busy="true">
            <div class="loading-box">
                <div class="spinner" aria-hidden="true"></div>
                <div class="loading-text" id="loadingText">Working on it...</div>
            </div>
        </div>

        <div id="statusMessage"></div>

        <div class="tabs">
            <button class="tab active" onclick="switchTab('pending', event)">â³ Pending Approvals</button>
            <button class="tab" onclick="switchTab('registrations', event)">ğŸ“ Registration Requests</button>
            <button class="tab" onclick="switchTab('summary', event)">ğŸ“Š Summary</button>
            <button class="tab" onclick="switchTab('balance', event)">ğŸ’µ My Balance</button>
            <button class="tab" onclick="switchTab('participants', event)">ğŸ‘¥ Participants</button>
            <button class="tab" onclick="switchTab('links', event)">ğŸ”— User Links</button>
            <button class="tab" onclick="switchTab('expenses', event)">ğŸ’° Expenses</button>
            <button class="tab" onclick="switchTab('settlements', event)">ğŸ§® Settlements</button>
            <button class="tab" onclick="switchTab('cache', event)">âš¡ Cache Settings</button>
        </div>

        <!-- Pending Approvals Tab -->
        <div id="pending" class="tab-content active">
            <h2>Pending Expense Approvals</h2>
            <div id="pendingList">
                <!-- Pending expenses will be loaded here -->
            </div>
        </div>

        <!-- Registration Requests Tab -->
        <div id="registrations" class="tab-content">
            <h2>Registration Requests</h2>
            <p class="note-text">
                Users who want to join the group will appear here. Approve or reject their registration requests.
            </p>
            <div id="registrationList">
                <!-- Registration requests will be loaded here -->
            </div>
        </div>

        <!-- Summary Tab -->
        <div id="summary" class="tab-content">
            <h2>Expense Summary</h2>
            
            <div class="summary-section">
                <div class="summary-card">
                    <h3>Total Group Expenses</h3>
                    <div class="summary-amount" id="totalGroupExpense">â‚¹0.00</div>
                </div>
            </div>

            <div class="summary-section">
                <h3>Individual Expenses</h3>
                <p class="note-text">Total amount paid by each person (approved expenses only)</p>
                <div id="individualExpensesList">
                    <!-- Individual expenses will be loaded here -->
                </div>
            </div>

            <div class="summary-section">
                <h3>Individual Shares</h3>
                <p class="note-text">Total amount each person owes (their share of all expenses)</p>
                <div id="individualSharesList">
                    <!-- Individual shares will be loaded here -->
                </div>
            </div>
        </div>

        <!-- My Balance Tab -->
        <div id="balance" class="tab-content">
            <h2>My Balance Summary</h2>
            <div id="adminBalanceSummary">
                <!-- Balance summary will be shown here -->
            </div>
        </div>

        <!-- User Links Tab -->
        <div id="links" class="tab-content">
            <h2>All User Links</h2>
            <p class="note-text">
                Access links for all users are stored here. You can retrieve and share them if users lose their links.
                The admin link is automatically stored. Add the shared user link below for easy retrieval.
            </p>
            
            <div class="form-group">
                <label>Add Shared User Link (from setup page):</label>
                <input type="text" id="sharedUserLink" placeholder="Paste the shared user link from setup page">
                <button class="btn btn-primary btn-margin-top" onclick="addSharedUserLink()">â• Store User Link</button>
                <p class="note-text" style="margin-top: 8px; font-size: 13px;">
                    ğŸ’¡ Copy the "User Link" from the setup page and paste it here to store it for future reference.
                </p>
            </div>
            
            <div id="userLinksList">
                <!-- User links will be loaded here -->
            </div>
        </div>

        <!-- Participants Tab -->
        <div id="participants" class="tab-content">
            <h2>Manage Participants</h2>
            
            <div class="form-group">
                <label>Add Participant:</label>
                <input type="text" id="participantName" placeholder="Enter name">
                <button class="btn btn-primary btn-margin-top" onclick="addParticipant()">â¡ï¸ Add Participant</button>
            </div>

            <div class="participant-list" id="participantList">
                <!-- Participants will be loaded here -->
            </div>
        </div>

        <!-- Expenses Tab -->
        <div id="expenses" class="tab-content">
            <h2>Add New Expense (Auto-Approved)</h2>
            
            <div id="expenseForm">
                <div class="form-group">
                    <label>Date:</label>
                    <input type="date" id="expenseDate">
                    <div class="field-error" id="error-expenseDate"></div>
                </div>

                <div class="form-group">
                    <label>Description:</label>
                    <input type="text" id="expenseDescription" placeholder="e.g., Dinner at restaurant">
                    <div class="field-error" id="error-expenseDescription"></div>
                </div>

                <div class="form-group">
                    <label>Amount (â‚¹):</label>
                    <input type="number" id="expenseAmount" placeholder="0.00" step="0.01">
                    <div class="field-error" id="error-expenseAmount"></div>
                </div>

                <div class="form-group">
                    <label>Paid By:</label>
                    <select id="expensePaidBy">
                        <option value="">Select participant...</option>
                    </select>
                    <div class="field-error" id="error-expensePaidBy"></div>
                </div>

                <div class="form-group">
                    <label>Split Between:</label>
                    <div id="splitCheckboxes" class="split-checkboxes">
                        <!-- Checkboxes will be loaded here -->
                    </div>
                    <div class="field-error" id="error-splitBetween"></div>
                </div>

                <button id="submitBtn" class="btn btn-primary" onclick="submitExpense()">âœ… Add Expense</button>
            </div>

            <h2 class="section-margin-top">All Expenses</h2>
            <div class="expense-list" id="expenseList">
                <!-- Expenses will be loaded here -->
            </div>
        </div>

        <!-- Settlements Tab -->
        <div id="settlements" class="tab-content">
            <h2>Settlement Calculations</h2>
            
            <div class="settlement-summary">
                <h3>Who Owes Whom</h3>
                <div id="settlementList">
                    <!-- Settlement calculations will be shown here -->
                </div>
            </div>

            <div class="settlement-confirmations">
                <h3>Confirmed Settlements</h3>
                <div id="confirmedSettlements">
                    <!-- Confirmed settlements will be shown here -->
                </div>
            </div>
        </div>

        <!-- Cache Settings Tab -->
        <div id="cache" class="tab-content">
            <h2>Cache Management</h2>
            <p class="note-text">
                The app caches data for 5 minutes to improve performance. 
                Caches are automatically cleared when data is updated (add/edit/approve/reject).
            </p>
            
            <div class="form-group" style="margin-top: 20px;">
                <h3>Automatic Cache Refresh</h3>
                <p class="note-text">
                    Enable automatic cache refresh to keep data synced in the background every 5 minutes.
                    This ensures fast loading even when users haven't accessed the app recently.
                </p>
                
                <div id="triggerStatus" style="margin: 15px 0; padding: 12px; background: #f5f5f5; border-radius: 8px;">
                    <p style="margin: 0;"><strong>Status:</strong> <span id="triggerStatusText">Checking...</span></p>
                </div>
                
                <div style="display: flex; gap: 10px; margin-top: 10px;">
                    <button class="btn btn-primary" onclick="enableCacheTrigger()">ğŸ”„ Enable Auto-Refresh</button>
                    <button class="btn" onclick="disableCacheTrigger()">â¸ï¸ Disable Auto-Refresh</button>
                    <button class="btn" onclick="refreshCacheNow()">âš¡ Refresh Now</button>
                </div>
            </div>
            
            <div class="form-group" style="margin-top: 30px;">
                <h3>Cache Information</h3>
                <div class="note-text">
                    <ul style="margin: 10px 0; padding-left: 20px;">
                        <li><strong>Cache Duration:</strong> 5 minutes</li>
                        <li><strong>Cached Data:</strong> Participants, Expenses (Admin & User views), Settlements</li>
                        <li><strong>Auto-Invalidation:</strong> When adding, editing, approving, or rejecting expenses/participants</li>
                        <li><strong>Auto-Refresh Interval:</strong> Every 5 minutes (when enabled)</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <script type="module" src="js/admin.js"></script>
</body>
</html>

