<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sabarimala 2026 - Expense Tracker</title>
    
    <!-- Google Sign-In Library -->
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    
    <!-- Application Styles -->
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ™ Sabarimala 2026</h1>
            <p>Expense & Settlement Tracker</p>
        </div>

        <div id="statusMessage"></div>

        <div class="tabs">
            <button class="tab active" onclick="switchTab('participants')">ğŸ‘¥ Participants</button>
            <button class="tab" onclick="switchTab('expenses')">ğŸ’° Expenses</button>
            <button class="tab" onclick="switchTab('settlements')">ğŸ§® Settlements</button>
            <button class="tab" onclick="window.location.href='setup.html'" style="background: #28a745; margin-left: auto;">âš™ï¸ Setup</button>
        </div>

        <!-- Participants Tab -->
        <div id="participants" class="tab-content active">
            <div id="userManagementSection" style="display: none; margin-bottom: 40px; padding: 20px; background: #f8f9fa; border-radius: 12px;">
                <h2 style="margin-bottom: 20px;">ğŸ‘¤ User Management (Admin Only)</h2>
                
                <div id="pendingRegistrations" style="margin-bottom: 30px;">
                    <!-- Pending registrations will be loaded here -->
                </div>

                <div id="userList" style="margin-top: 20px;">
                    <!-- Approved users will be loaded here -->
                </div>
            </div>
            
            <h2>Manage Participants</h2>
            
            <div class="form-group">
                <label>Add Participant:</label>
                <input type="text" id="participantName" placeholder="Enter name">
                <button class="btn btn-primary" onclick="addParticipant()" style="margin-top: 10px;">â• Add Participant</button>
            </div>

            <div class="participant-list" id="participantList">
                <!-- Participants will be loaded here -->
            </div>
        </div>

        <!-- Expenses Tab -->
        <div id="expenses" class="tab-content">
            <h2>Add New Expense</h2>
            
            <div class="form-group">
                <label>Date:</label>
                <input type="date" id="expenseDate">
            </div>

            <div class="form-group">
                <label>Description:</label>
                <input type="text" id="expenseDescription" placeholder="e.g., Dinner at restaurant">
            </div>

            <div class="form-group">
                <label>Amount (â‚¹):</label>
                <input type="number" id="expenseAmount" placeholder="0.00" step="0.01" min="0">
            </div>

            <div class="form-group">
                <label>Paid By:</label>
                <select id="expensePaidBy">
                    <option value="">Select...</option>
                </select>
            </div>

            <div class="form-group">
                <label>Split Between:</label>
                <div style="margin-bottom: 10px;">
                    <button class="btn btn-secondary" onclick="selectAllSplit()" type="button" style="padding: 8px 20px;">âœ“ Select All</button>
                    <button class="btn btn-secondary" onclick="deselectAllSplit()" type="button" style="padding: 8px 20px;">âœ— Deselect All</button>
                </div>
                <div class="checkbox-group" id="splitBetweenCheckboxes">
                    <!-- Checkboxes will be loaded here -->
                </div>
            </div>

            <button class="btn btn-primary" onclick="addExpense()">ğŸ’° Add Expense</button>

            <hr style="margin: 30px 0; border: 1px solid #dee2e6;">

            <h2>All Expenses</h2>
            <div class="expense-list" id="expenseList">
                <!-- Expenses will be loaded here -->
            </div>
        </div>

        <!-- Edit Expense Modal -->
        <div id="editModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>âœï¸ Edit Expense</h2>
                    <button class="close-modal" onclick="closeEditModal()">Ã—</button>
                </div>

                <div class="form-group">
                    <label>Date:</label>
                    <input type="date" id="editExpenseDate">
                </div>

                <div class="form-group">
                    <label>Description:</label>
                    <input type="text" id="editExpenseDescription" placeholder="e.g., Dinner at restaurant">
                </div>

                <div class="form-group">
                    <label>Amount (â‚¹):</label>
                    <input type="number" id="editExpenseAmount" placeholder="0.00" step="0.01" min="0">
                </div>

                <div class="form-group">
                    <label>Paid By:</label>
                    <select id="editExpensePaidBy">
                        <option value="">Select...</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Split Between:</label>
                    <div style="margin-bottom: 10px;">
                        <button class="btn btn-secondary" onclick="selectAllEditSplit()" type="button" style="padding: 8px 20px;">âœ“ Select All</button>
                        <button class="btn btn-secondary" onclick="deselectAllEditSplit()" type="button" style="padding: 8px 20px;">âœ— Deselect All</button>
                    </div>
                    <div class="checkbox-group" id="editSplitBetweenCheckboxes">
                        <!-- Checkboxes will be loaded here -->
                    </div>
                </div>

                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button class="btn btn-primary" onclick="saveExpenseEdit()">ğŸ’¾ Save Changes</button>
                    <button class="btn btn-secondary" onclick="closeEditModal()">Cancel</button>
                </div>
            </div>
        </div>

        <!-- Settlements Tab -->
        <div id="settlements" class="tab-content">
            <h2>Balance Summary</h2>
            <div class="balance-grid" id="balanceGrid">
                <!-- Balances will be calculated here -->
            </div>

            <h2>ğŸ’¸ Who Needs to Pay Whom</h2>
            <p style="color: #666; margin-bottom: 20px;">Complete these transactions to settle all debts:</p>
            <div class="settlement-list" id="settlementList">
                <!-- Settlement transactions will be calculated here -->
            </div>
        </div>
    </div>

    <!-- Access Control Modal -->
    <div id="accessModal" class="modal active" style="background-color: rgba(0,0,0,0.8);">
        <div class="modal-content" style="max-width: 500px;">
            <div style="text-align: center; margin-bottom: 30px;">
                <h1 style="color: #667eea; margin-bottom: 10px;">ğŸ™ Sabarimala 2026</h1>
                <h2 style="color: #333; margin-bottom: 20px;">Expense Tracker</h2>
                <p style="color: #666;" id="welcomeMessage">Sign in with your Google account</p>
            </div>

            <div id="googleSignInButton" style="display: flex; justify-content: center; margin-bottom: 20px;"></div>

            <div id="accessError" style="margin-top: 15px;"></div>
            
            <div style="text-align: center; margin-top: 20px; padding-top: 20px; border-top: 1px solid #dee2e6;">
                <p style="font-size: 0.9em; color: #666; margin-bottom: 10px;">First time? Sign in to request access</p>
                <p style="font-size: 0.85em; color: #999;">Admin will approve your registration</p>
            </div>
        </div>
    </div>

    <!-- Admin API Setup Modal -->
    <div id="apiSetupModal" class="modal" style="background-color: rgba(0,0,0,0.9); display: none;">
        <div class="modal-content" style="max-width: 600px;">
            <div style="text-align: center; margin-bottom: 30px;">
                <h2 style="color: #667eea; margin-bottom: 10px;">ğŸ” Secure Setup Required</h2>
                <p style="color: #666;">As the admin, please provide the Google Apps Script API URL</p>
            </div>

            <div style="background: #fff3cd; border-left: 4px solid #ffc107; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                <p style="color: #856404; margin: 0; font-size: 14px;">
                    <strong>ğŸ”’ Security Best Practice:</strong> The API URL is not stored in GitHub. 
                    Only you (the admin) will provide it once, and it's stored securely in your browser.
                </p>
            </div>

            <div style="margin-bottom: 20px;">
                <label style="display: block; margin-bottom: 8px; color: #333; font-weight: 600;">
                    Google Apps Script Web App URL *
                </label>
                <input type="url" id="adminApiUrl" 
                    placeholder="https://script.google.com/macros/s/.../exec"
                    style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 14px;">
                <p style="font-size: 12px; color: #999; margin-top: 5px;">
                    Get this URL from: Extensions â†’ Apps Script â†’ Deploy â†’ Web app URL
                </p>
            </div>

            <div style="background: #e3f2fd; border-left: 4px solid #2196F3; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                <p style="color: #1976d2; margin: 0; font-size: 13px; line-height: 1.6;">
                    <strong>Quick Steps:</strong><br>
                    1. Open your Google Sheet<br>
                    2. Extensions â†’ Apps Script<br>
                    3. Deploy â†’ Manage deployments<br>
                    4. Copy the Web App URL<br>
                    5. Paste it above
                </p>
            </div>

            <button onclick="saveAdminApiUrl()" 
                style="width: 100%; padding: 14px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
                color: white; border: none; border-radius: 8px; font-size: 16px; font-weight: 600; cursor: pointer;">
                ğŸ” Save & Continue
            </button>

            <p style="text-align: center; margin-top: 15px; font-size: 12px; color: #999;">
                This URL will be stored locally and encrypted in your browser only
            </p>
        </div>
    </div>

    <!-- Application Scripts - Load in order -->
    <script src="js/config.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/participants.js"></script>
    <script src="js/expenses.js"></script>
    <script src="js/settlements.js"></script>
    <script src="js/users.js"></script>
    <script src="js/app.js"></script>
</body>
</html>
